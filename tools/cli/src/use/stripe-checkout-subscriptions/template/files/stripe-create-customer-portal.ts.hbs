import { NextApiRequest, NextApiResponse } from "next";
import { createCustomerPortalSessionMiddleware } from "@hyper-next/stripe";
import { randomUUID } from "crypto";

const returnUrl: string; // TODO return URL after user is done with portal

const stripeSecretKey: string; // TODO get a Stripe Secret Key

// TODO define a function that gets the Stripe customer ID for a give user ID
const getCustomerId: (userId: string) => Promise<string> | string,

// TODO Optional: Create a winston logger for logging. https://www.npmjs.com/package/winston
const logger;

const handler = async (req: NextApiRequest, res: NextApiResponse) => {
  // create a child logger to track this specific request
  const requestLogger = logger
    ? logger.child({ requestId: randomUUID() })
    : undefined;

  await createCustomerPortalSessionMiddleware(
    returnUrl
    stripeSecretKey,
    getCustomerId,
    req,
    res,
    requestLogger
  );
};

export default handler;
